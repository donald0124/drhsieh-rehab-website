---
// src/components/Services.astro
// (這現在是 "資料" 中心)
import { getCollection } from 'astro:content';
import ServiceItem from './ServiceItem.astro'; // <--- (1. 匯入您的新樣板)

// (取得衛教專欄文章，這部分邏輯不變)
const blogPosts = await getCollection('blog');
const getPostSlug = (tag: string) => {
    const sortedPosts = blogPosts.sort(
        (a, b) => b.data.pubDate.valueOf() - a.data.pubDate.valueOf()
    );
    const post = sortedPosts.find(p => p.data.tags?.includes(tag));
    // (優化) 如果找不到文章，就回傳 null
    return post ? { slug: `/blog/${post.slug}/`, title: post.data.title } : null;
};

// (手動取得文章連結)
const mommyThumbPost = getPostSlug('媽媽手');
const runnerKneePost = getPostSlug('跑者膝');
const neimsPost = getPostSlug('NEIMS');


// --- (2. 這裡是您易於維護的「資料區」) ---
// 未來您要新增/修改，只需要動這裡的文字
const servicesData = [
  {
    title: "頭頸",
    tags: ["顳顎關節障礙", "顏面神經麻痺", "落枕", "肩頸痠痛", "甩鞭症候群"],
    symptoms: [
      "早上起床脖子卡住，轉頭就痛 (落枕)",
      "嘴巴打開會痛、有「喀喀」聲 (顳顎關節)",
      "肩頸長期僵硬，甚至引起頭痛"
    ],
    relatedPosts: [] // (目前沒有，可留空)
  },
  {
    title: "上肢",
    tags: ["五十肩 (冰凍肩)", "網球肘 (外上髁炎)", "媽媽手 (狹窄性肌腱滑膜炎)", "腕隧道症候群", "高爾夫球肘", "板機指", "肩夾擠症候群", "旋轉肌袖損傷"],
    symptoms: [
      "肩膀卡住，手舉不起來，無法穿脫衣服，半夜會痛醒",
      "手肘外側壓了會痛，擰毛巾或提重物時會無力",
      "手腕大拇指側疼痛，抓握東西 (如抱小孩) 時更明顯",
      "手指又麻又痛，尤其晚上睡覺或騎車時更嚴重"
    ],
    // (自動連結 "媽媽手" 和新增 "五十肩" 文章)
    relatedPosts: [
      mommyThumbPost, // (來自 getPostSlug)
      { slug: "#", title: "告別五十肩，三招居家運動" } // (範例)
    ].filter(post => post !== null) // (過濾掉找不到的文章)
  },
  {
    title: "下肢",
    tags: ["梨狀肌症候群", "跑者膝 (髂脛束摩擦症候群)", "跳躍膝", "足底筋膜炎", "扁平足", "十字韌帶術後", "人工膝/髖關節術後", "拇趾外翻"],
    symptoms: [
      "早上起床腳踩地，腳跟劇痛 (足底筋膜炎)",
      "跑步時膝蓋外側疼痛 (跑者膝)",
      "臀部深深地痠痛，甚至有點麻到小腿 (梨狀肌)"
    ],
    relatedPosts: [
      runnerKneePost // (來自 getPostSlug)
    ].filter(post => post !== null)
  },
  {
    title: "脊椎",
    tags: ["椎間盤突出", "脊椎側彎", "坐骨神經痛", "骨刺", "僵直性脊椎炎", "壓迫性骨折術後"],
    symptoms: [
      "彎腰或打噴嚏時，背部劇痛並伴隨腿部麻木 (椎間盤突出)",
      "無法久坐或久站，下背部持續痠痛",
      "走路時感覺腿部無力、緊繃，像被電到 (坐骨神經痛)"
    ],
    relatedPosts: []
  },
  {
    title: "全身性 / 其他",
    tags: ["肌筋膜疼痛", "肌少症", "運動傷害", "退化性關節炎", "腦中風及神經復健", "骨外科術後疼痛", "帕金森氏症"],
    symptoms: [
      "全身多處痠痛，有特定壓了會劇痛的「激痛點」",
      "走路遲緩、握力下降、容易跌倒 (肌少症)",
      "運動中扭傷、拉傷，或術後關節僵硬、疼痛"
    ],
    relatedPosts: [
      neimsPost // (來自 getPostSlug)
    ].filter(post => post !== null)
  }
];
---

<section id="services" class="py-16 md:py-24 bg-gray-50">
    <div class="container mx-auto px-4 max-w-5xl">

        <div class="text-center mb-12">
            <h2 class="text-3xl md:text-4xl font-bold text-gray-900 mb-4">治療項目</h2>
            <p class="text-lg text-gray-600 max-w-2xl mx-auto">快速對照您的症狀，了解我們如何提供專業、整合性的解決方案。</p>
        </div>

        <div id="accordion-container" class="space-y-4">
            {servicesData.map(item => (
                <ServiceItem
                    title={item.title}
                    tags={item.tags}
                    symptoms={item.symptoms}
                    relatedPosts={item.relatedPosts}
                />
            ))}
        </div> 
        
        <div class="mt-12 md:mt-24 max-w-5xl mx-auto">
            <h3 class="text-2xl md:text-3xl font-bold text-gray-800 mb-4">我們的治療原則：精準與整合</h3>
            <p class="text-lg text-gray-800 mb-8">
                無論您的困擾屬於哪個分類，謝明福復健科診所都秉持「<strong>精準診斷、整合治療</strong>」的核心原則，為您制定最有效率的康復方案：
            </p>
            
            <ul class="grid md:grid-cols-3 gap-6 justify-center space-y-0 text-gray-700">
                <li class="flex items-start gap-3 bg-white p-6 rounded-lg shadow-sm">
                    <span class="text-blue-600 font-bold text-xl flex-shrink-0">✓</span>
                    <div>
                        <strong class="text-gray-900">精準診斷</strong>: 醫師將透過專業理學檢查，找到疼痛的真正根源 (肌肉、肌腱、韌帶、神經、關節或其他肇因)。
                    </div>
                </li>
                <li class="flex items-start gap-3 bg-white p-6 rounded-lg shadow-sm">
                    <span class="text-blue-600 font-bold text-xl flex-shrink-0">✓</span>
                    <div>
                        <strong class="text-gray-900">整合性治療</strong>: 結合多元儀器物理治療及院長專長（如<strong>直線偏極光治療 SuperLizer</strong> / <strong>針極肌肉內電刺激 NEIMS</strong>）進行治療。
                    </div>
                </li>
                <li class="flex items-start gap-3 bg-white p-6 rounded-lg shadow-sm">
                    <span class="text-blue-600 font-bold text-xl flex-shrink-0">✓</span>
                    <div>
                        <strong class="text-gray-900">客製化運動</strong>: 指導正確的伸展與肌力訓練，強化核心穩定度，預防復發。
                    </div>
                </li>
            </ul>
        </div>

        <div class="specialty-section mt-16 md:mt-24">
            <div class="text-center mb-12">
                <h2 class="text-3xl md:text-4xl font-bold text-gray-900 mb-4">特別專長</h2>
                <p class="text-lg text-gray-600 max-w-2xl mx-auto">除了健保給付的各項儀器物理治療，我們更提供先進的自費治療選項，加速您的康復</p>
            </div>
            
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6">
                <div class="card bg-white p-6 rounded-lg shadow-lg hover:shadow-xl transition-shadow duration-300">
                    <h3 class="text-xl font-semibold text-blue-800 mb-2">針極肌肉內電刺激 (NEIMS)</h3>
                    <p class="text-gray-600">精準治療深層痛點，立即放鬆緊繃肌肉。</p>
                </div>
                <div class="card bg-white p-6 rounded-lg shadow-lg hover:shadow-xl transition-shadow duration-300">
                    <h3 class="text-xl font-semibold text-blue-800 mb-2">直線偏光治療儀 (Superlizer)</h3>
                    <p class="text-gray-600">緩解深層疼痛、促進組織修復、改善自律神經失調。</p>
                </div>
                <div class="card bg-white p-6 rounded-lg shadow-lg hover:shadow-xl transition-shadow duration-300">
                    <h3 class="text-xl font-semibold text-blue-800 mb-2">關節玻尿酸注射</h3>
                    <p class="text-gray-600">潤滑關節，緩解退化性關節炎不適。</p>
                </div>
                <div class="card bg-white p-6 rounded-lg shadow-lg hover:shadow-xl transition-shadow duration-300">
                    <h3 class="text-xl font-semibold text-blue-800 mb-2">葡萄糖水增生注射</h3>
                    <p class="text-gray-600">刺激軟組織修復，強化受傷的韌帶與肌腱。</p>
                </div>
            </div>
        </div>

    </div>
</section>