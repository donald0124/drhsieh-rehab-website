---
import type { MarkdownHeading } from "astro";

interface Props {
    headings: MarkdownHeading[];
    accordion?: boolean;
}

const { headings, accordion = false } = Astro.props;

// Filter only h2 and h3
const toc = headings.filter(
    (heading) => heading.depth === 2 || heading.depth === 3,
);
---

{
    toc.length > 0 &&
        (accordion ? (
            <details class="toc-accordion">
                <summary class="toc-summary">本文目錄</summary>
                <nav class="toc-container">
                    <ul class="toc-list">
                        {toc.map((heading) => (
                            <li class={`toc-item depth-${heading.depth}`}>
                                <a href={`#${heading.slug}`}>{heading.text}</a>
                            </li>
                        ))}
                    </ul>
                </nav>
            </details>
        ) : (
            <nav class="toc-container">
                <h2 class="toc-title">本文目錄</h2>
                <ul class="toc-list">
                    {toc.map((heading) => (
                        <li class={`toc-item depth-${heading.depth}`}>
                            <a href={`#${heading.slug}`}>{heading.text}</a>
                        </li>
                    ))}
                </ul>
            </nav>
        ))
}

<style>
    .toc-container {
        background-color: #f9fafb;
        padding: 1.5rem;
        border-radius: 8px;
        margin-bottom: 1rem;
        border: 1px solid #e5e7eb;
    }

    .toc-title {
        font-size: 0.9rem;
        font-weight: bold;
        margin-bottom: 1rem;
        color: var(--color-text);
        border-bottom: 2px solid var(--color-primary-light);
        padding-bottom: 0.5rem;
    }

    .toc-list {
        font-size: 0.8rem;
        list-style: none;
        padding: 0;
        margin: 0;
    }

    .toc-item {
        font-size: 0.8rem;
        margin-bottom: 0.5rem;
    }

    .toc-item a {
        font-size: 0.8rem;
        text-decoration: none;
        color: var(--color-text);
        transition: color 0.2s;
        display: block;
        padding: 0.25rem 0;
    }

    .toc-item a:hover {
        color: var(--color-primary);
        background-color: #f0f9ff;
        padding-left: 0.5rem;
        border-radius: 4px;
    }

    .depth-2 {
        font-weight: 600;
    }

    .depth-3 {
        padding-left: 1.5rem;
        font-size: 0.95rem;
        color: #666;
    }

    /* Accordion Styles */
    .toc-accordion {
        background-color: #f9fafb;
        border-radius: 8px;
        border: 1px solid #e5e7eb;
        margin-bottom: 2rem;
        overflow: hidden;
    }

    .toc-summary {
        background-color: #f0f6fa;
        padding: 1rem 1.5rem;
        font-weight: bold;
        cursor: pointer;
        color: var(--color-primary-dark);
        list-style: none; /* Hide default triangle in some browsers */
        display: flex;
        align-items: center;
        justify-content: space-between;
    }

    /* Custom Arrow for Summary */
    .toc-summary::after {
        content: "▼";
        font-size: 0.8rem;
        transition: transform 0.3s;
    }

    details[open] .toc-summary::after {
        transform: rotate(180deg);
    }

    /* Remove default arrow in Chrome/Safari */
    .toc-summary::-webkit-details-marker {
        display: none;
    }

    /* Adjust container style when inside accordion */
    details .toc-container {
        border: none;
        margin: 0;
        border-radius: 0;
        background-color: transparent;
        padding-top: 0;
    }
</style>
